<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modern XML Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #f9fafb;
      --fg: #222;
      --container-bg: #fff;
      --tree-bg: #f3f4f6;
      --tag: #0451a5;
      --attr: #795e26;
      --val: #008000;
      --comment: #6a9955;
      --cdata: #af00db;
      --btn: #2563eb;
      --btn-hover: #1e40af;
    }
    html.dark {
      --bg: #202b38;
      --fg: #e8f0fb;
      --container-bg: #232e3c;
      --tree-bg: #202b38;
      --tag: #7ec7ff;
      --attr: #fae17d;
      --val: #c3e88d;
      --comment: #7a869a;
      --cdata: #f78c6c;
      --btn: #2563eb;
      --btn-hover: #1e40af;
    }
    body {
      font-family: 'JetBrains Mono', 'Fira Mono', Arial, sans-serif;
      margin: 0; padding: 20px;
      background: var(--bg); color: var(--fg);
      transition: background .2s, color .2s;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 10px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: var(--container-bg);
      padding: 22px 18px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: background .2s;
    }
    textarea {
      width: 100%;
      height: 200px;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #314155;
      background: var(--tree-bg);
      color: var(--fg);
      resize: vertical;
      transition: background .2s, color .2s;
    }
    .toolbar {
      display: flex; gap: 0.7em; flex-wrap: wrap; margin-bottom: 1em;
      align-items: center;
    }
    .toolbar button, .toolbar label {
      background: var(--btn);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.15s;
      margin-bottom: 5px;
    }
    .toolbar button:hover, .toolbar label:hover { background: var(--btn-hover);}
    .toolbar input[type="file"] { display: none; }
    .toggle-mode {
      background: none;
      color: var(--btn);
      border: 2px solid var(--btn);
      padding: 9px 16px;
      margin-left: auto;
      margin-right: 0;
      font-weight: bold;
      transition: background .15s, color .15s, border .15s;
    }
    .toggle-mode:hover {
      background: var(--btn);
      color: #fff;
    }
    .tree {
      font-family: 'JetBrains Mono', 'Fira Mono', monospace;
      background: var(--tree-bg);
      color: var(--fg);
      padding: 12px;
      border-radius: 8px;
      overflow-x: auto;
      white-space: pre;
      font-size: 1.07em;
      line-height: 1.7;
      border: 1px solid #314155;
      min-height: 80px;
      margin-bottom: 2em;
      transition: background .2s, color .2s;
    }
    .node {
      position: relative;
      user-select: text;
      margin-left: 20px;
    }
    .collapsed > .children { display: none; }
    .tag { color: var(--tag); }
    .attr { color: var(--attr); }
    .val { color: var(--val); }
    .comment { color: var(--comment);}
    .cdata { color: var(--cdata);}
    .fold-toggle {
      position: absolute;
      left: -1.4em;
      top: 1px;
      background: none;
      border: none;
      color: var(--tag);
      cursor: pointer;
      font-size: 1em;
      z-index: 2;
      padding: 0;
      margin: 0;
      transition: color .15s;
    }
    .fold-toggle:hover { color: #ffe066; }
    .child-count {
      font-size: 0.9em;
      color: #5d7290;
      margin-left: 0.5em;
    }
    @media (max-width: 600px) {
      .container { padding: .7em .2em 1em .2em; }
      .tree { font-size: 0.97em;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Modern XML Viewer</h1>
    <p>Paste your XML below or upload a file to view it in a collapsible tree format. <strong>Switch instantly between Light/Dark mode!</strong></p>

    <textarea id="xmlInput">&lt;?xml version="1.0"?&gt;
&lt;books&gt;
  &lt;book id="bk101"&gt;
    &lt;author&gt;Author 1&lt;/author&gt;
    &lt;title&gt;Title 1&lt;/title&gt;
    &lt;genre&gt;Fiction&lt;/genre&gt;
    &lt;price&gt;10.99&lt;/price&gt;
    &lt;publish_date&gt;2020-01-01&lt;/publish_date&gt;
    &lt;description&gt;Sample desc&lt;/description&gt;
  &lt;/book&gt;
  &lt;book id="bk102"&gt;
    &lt;author&gt;Author 2&lt;/author&gt;
    &lt;title&gt;Title 2&lt;/title&gt;
    &lt;genre&gt;Nonfiction&lt;/genre&gt;
    &lt;price&gt;12.99&lt;/price&gt;
    &lt;publish_date&gt;2021-02-02&lt;/publish_date&gt;
    &lt;description&gt;Sample desc 2&lt;/description&gt;
  &lt;/book&gt;
&lt;/books&gt;
    </textarea>
    <div class="toolbar">
      <button onclick="beautifyAndRender()">Beautify & View</button>
      <button onclick="collapseAll()">Collapse All</button>
      <button onclick="expandAll()">Expand All</button>
      <button onclick="downloadXML()">Download</button>
      <label>
        Upload
        <input type="file" id="fileInput" accept=".xml,text/xml" />
      </label>
      <button id="toggleMode" class="toggle-mode" title="Toggle light/dark mode">🌙 Dark Mode</button>
    </div>
    <div id="output" class="tree"></div>
  </div>

  <script>
    // Dark/Light mode logic
    function setMode(mode, persist) {
      document.documentElement.classList.toggle('dark', mode === 'dark');
      const btn = document.getElementById('toggleMode');
      btn.textContent = mode === 'dark' ? '☀️ Light Mode' : '🌙 Dark Mode';
      if (persist) localStorage.setItem('xmlviewer-mode', mode);
    }
    function toggleMode() {
      const isDark = document.documentElement.classList.contains('dark');
      setMode(isDark ? 'light' : 'dark', true);
    }
    (() => {
      let mode = localStorage.getItem('xmlviewer-mode');
      if (!mode) {
        mode = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      setMode(mode, false);
    })();
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('toggleMode').onclick = toggleMode;
    });

    // XML Viewer logic
    document.getElementById("fileInput").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        document.getElementById("xmlInput").value = ev.target.result;
        beautifyAndRender();
      };
      reader.readAsText(file);
    });

    let foldNodes = [];

    function beautifyAndRender() {
      const input = document.getElementById("xmlInput").value.trim();
      if (!input) return alert("Please enter or upload XML.");
      try {
        // Remove any leading blank lines or whitespace
        const xmlText = input.replace(/^\s+/, '');
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, "application/xml");
        if (xmlDoc.getElementsByTagName("parsererror").length > 0) {
          throw new Error("Invalid XML");
        }
        const output = document.getElementById("output");
        output.innerHTML = "";
        foldNodes = [];
        // Find the first element node (skip XML declaration)
        let root = Array.from(xmlDoc.childNodes).find(n => n.nodeType === 1);
        if (!root) throw new Error("No root element found");
        renderNode(root, output, 0);
      } catch (err) {
        document.getElementById("output").innerHTML =
          `<span style="color:#ff7675;font-weight:600;font-size:1.1em;padding:1em;">Error parsing XML: ${err.message}</span>`;
      }
    }

    function renderNode(node, container, depth) {
      if (node.nodeType === Node.TEXT_NODE && !node.nodeValue.trim()) return;
      if (node.nodeType === Node.ELEMENT_NODE) {
        const div = document.createElement("div");
        div.className = "node";
        div.style.marginLeft = (depth * 20) + "px";

        // Folding toggle
        const childElementNodes = Array.from(node.childNodes).filter(c => c.nodeType === Node.ELEMENT_NODE);
        const hasChildren = childElementNodes.length > 0;
        const foldBtn = document.createElement("button");
        foldBtn.className = "fold-toggle";
        foldBtn.innerHTML = hasChildren ? "&#9660;" : "&#9654;";
        foldBtn.title = "Collapse/Expand";
        foldBtn.onclick = function(e) {
          e.stopPropagation();
          div.classList.toggle("collapsed");
          foldBtn.innerHTML = div.classList.contains("collapsed") ? "&#9654;" : "&#9660;";
        };
        div.appendChild(foldBtn);
        foldNodes.push({ div, btn: foldBtn });

        // Start tag
        const tagOpen = document.createElement("span");
        tagOpen.innerHTML = `&lt;<span class='tag'>${node.nodeName}</span>`;
        for (let attr of node.attributes) {
          tagOpen.innerHTML += ` <span class='attr'>${attr.name}</span>=<span class='val'>"${attr.value}"</span>`;
        }
        tagOpen.innerHTML += "&gt;";
        div.appendChild(tagOpen);

        // Child element count
        const childCountSpan = document.createElement("span");
        childCountSpan.className = "child-count";
        childCountSpan.textContent = `(${childElementNodes.length})`;
        div.appendChild(childCountSpan);

        // Children
        const childrenContainer = document.createElement("div");
        childrenContainer.className = "children";
        for (let child of node.childNodes) {
          renderNode(child, childrenContainer, depth + 1);
        }
        div.appendChild(childrenContainer);

        // End tag
        const tagClose = document.createElement("span");
        tagClose.innerHTML = `&lt;/<span class='tag'>${node.nodeName}</span>&gt;`;
        div.appendChild(tagClose);

        container.appendChild(div);
      } else if (node.nodeType === Node.TEXT_NODE) {
        const div = document.createElement("div");
        div.className = "node";
        div.appendChild(document.createTextNode(node.nodeValue.trim()));
        container.appendChild(div);
      } else if (node.nodeType === Node.COMMENT_NODE) {
        const div = document.createElement("div");
        div.className = "node comment";
        div.innerHTML += '<span class="comment">&lt;!-- ' + node.nodeValue + ' --&gt;</span>';
        container.appendChild(div);
      } else if (node.nodeType === Node.CDATA_SECTION_NODE) {
        const div = document.createElement("div");
        div.className = "node cdata";
        div.innerHTML += '<span class="cdata">&lt;![CDATA[' + node.nodeValue + ']]&gt;</span>';
        container.appendChild(div);
      }
    }

    function collapseAll() {
      foldNodes.forEach(({div, btn}) => {
        div.classList.add("collapsed");
        btn.innerHTML = "&#9654;";
      });
    }
    function expandAll() {
      foldNodes.forEach(({div, btn}) => {
        div.classList.remove("collapsed");
        btn.innerHTML = "&#9660;";
      });
    }

    function downloadXML() {
      const xml = document.getElementById("xmlInput").value;
      const blob = new Blob([xml], { type: "application/xml" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "xml-data.xml";
      link.click();
      URL.revokeObjectURL(url);
    }

    document.addEventListener("DOMContentLoaded", function() {
      beautifyAndRender();
      document.getElementById("xmlInput").addEventListener("input", beautifyAndRender);
    });
  </script>
</body>
</html>
