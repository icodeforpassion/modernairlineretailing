<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Modern Airline Retailing | Tools, Insights & Stories</title>
  <meta name="description" content="Practical tools and long-form insights on airline retailing. Offer & Order, inventory to stock, messaging, and real-world engineering practices."/>
  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>
  <link rel="preconnect" href="https://images.unsplash.com" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"/>
  <style>
    :root {
      --clr-bg: #0d1b2a;
      --clr-bg-alt:#132235;
      --clr-surface:#1f3145;
      --clr-surface-glass: rgba(31,49,69,0.55);
      --clr-border:#2f4a63;
      --clr-accent:#3298dc;
      --clr-accent-alt:#4fb1f5;
      --clr-text:#e8f0f7;
      --clr-text-dim:#9fb3c5;
      --radius: 14px;
      --transition: .28s cubic-bezier(.4,.2,.2,1);
      --shadow-1: 0 2px 6px -1px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.02) inset;
      --shadow-2: 0 8px 26px -6px rgba(0,0,0,.55);
      --gradient-hero: linear-gradient(160deg, rgba(13,27,42,.9), rgba(13,27,42,.55) 55%, rgba(30,55,80,.65));
      --focus-ring: 0 0 0 3px rgba(50,152,220,.5);
    }

    html { scroll-behavior: smooth; background: var(--clr-bg); }
    body { background: var(--clr-bg); color: var(--clr-text); font-feature-settings: "liga" 1, "kern" 1; }

    .navbar.is-dark {
      background: linear-gradient(to right, #0d1b2a, #142a40);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      border-bottom: 1px solid var(--clr-border);
    }
    .navbar a.navbar-item, .navbar a.navbar-link { color: var(--clr-text-dim); }
    .navbar a.navbar-item:hover, .navbar a.navbar-link:hover { color: var(--clr-text); background: transparent; }

    .hero.is-landing {
      position: relative;
      min-height: 520px;
      display: flex;
      align-items: center;
      background:
        var(--gradient-hero),
        url('/assets/og-banner.jpg') center/cover no-repeat;
      overflow: hidden;
    }
    .hero::after {
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(circle at 72% 30%, rgba(79,177,245,.15), transparent 60%),
        radial-gradient(circle at 20% 70%, rgba(50,152,220,.18), transparent 65%);
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .hero .container { max-width: 960px; }
    .title.is-1 {
      background: linear-gradient(92deg, #fff, #b9dcf5 45%, #4fb1f5 80%);
      -webkit-background-clip: text;
      color: transparent;
      font-weight: 700;
      letter-spacing: .5px;
    }

    .hero-cta {
      margin-top: 1.75rem;
      display: inline-flex;
      align-items: center;
      gap: .65rem;
      background: linear-gradient(135deg, var(--clr-accent) 0%, var(--clr-accent-alt) 100%);
      color: #fff !important;
      font-weight: 600;
      border: none;
      padding: .9rem 1.35rem;
      font-size: 1.05rem;
      border-radius: 999px;
      box-shadow: 0 6px 18px -4px rgba(50,152,220,.55), 0 2px 3px -1px rgba(0,0,0,.5);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      isolation: isolate;
      text-decoration:none;
    }
    .hero-cta::before {
      content:"";
      position:absolute;
      inset:0;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(255,255,255,.15), rgba(255,255,255,0));
      opacity:.6;
      pointer-events:none;
    }
    .hero-cta:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 28px -6px rgba(50,152,220,.6), 0 3px 5px -2px rgba(0,0,0,.55);
    }
    .hero-cta:active { transform: translateY(-1px); }
    .hero-cta:focus-visible { outline:none; box-shadow: var(--focus-ring); }

    .section {
      background: linear-gradient(to bottom, var(--clr-bg), var(--clr-bg-alt));
      padding-top: 4rem;
      padding-bottom: 4.5rem;
    }

    /* Ensure scroll target isn't hidden below fixed navbar */
    #featured { scroll-margin-top: 90px; }

    h2.title {
      background: linear-gradient(90deg, #fff, #c6d9e8 40%, #82bfe7);
      -webkit-background-clip:text;
      color:transparent;
      font-weight:600;
      letter-spacing:.3px;
    }

    #featured-cards {
      display:flex;
      flex-wrap:wrap;
      gap:2rem 1.5rem;
    }
    .post-card {
      flex:1 1 300px;
      max-width: 340px;
      background: linear-gradient(165deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.07);
      border-radius: var(--radius);
      box-shadow: var(--shadow-1);
      position:relative;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 410px;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      opacity:0;
      transform: translateY(24px) scale(.97);
      transition: var(--transition);
    }
    .post-card.reveal { opacity:1; transform: translateY(0) scale(1); }
    .post-card:hover {
      box-shadow: var(--shadow-2);
      transform: translateY(-6px) scale(1.015);
      border-color: var(--clr-accent-alt);
    }
    .post-card a {
      color: inherit;
      text-decoration:none;
      display:flex;
      flex-direction:column;
      height:100%;
    }
    .post-media {
      position:relative;
      height: 180px;
      overflow:hidden;
      background:linear-gradient(135deg,#1e354b,#244b66);
    }
    .post-media img {
      width:100%; height:100%; object-fit:cover;
      filter: saturate(105%) contrast(104%);
      transition: transform 1.4s ease, filter .6s ease;
    }
    .post-card:hover img { transform: scale(1.08); filter: saturate(118%) contrast(110%); }
    .post-media::after {
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(to top, rgba(13,27,42,.8), rgba(13,27,42,.05));
    }
    .badge-date {
      position:absolute;
      top:.75rem;
      left:.75rem;
      background:rgba(13,27,42,.75);
      color:#fff;
      padding:.35rem .6rem;
      border-radius:.5rem;
      font-size:.7rem;
      font-weight:600;
      letter-spacing:.5px;
      text-transform:uppercase;
      backdrop-filter:blur(6px);
      border:1px solid rgba(255,255,255,.15);
    }
    .img-badge{
      position:absolute;
      top:.75rem;
      right:.75rem;
      background:rgba(13,27,42,.7);
      color:#fff;
      font-size:.6rem;
      font-weight:600;
      letter-spacing:.5px;
      padding:.35rem .55rem;
      border-radius:.55rem;
      border:1px solid rgba(255,255,255,.18);
      text-transform:uppercase;
      backdrop-filter:blur(6px);
    }
    .post-body {
      padding: 1.15rem 1.2rem 1.25rem;
      display:flex;
      flex-direction:column;
      gap:.75rem;
    }
    .post-title { font-size:1.05rem; line-height:1.25; font-weight:600; color:#fff; margin:0; }
    .post-excerpt { font-size:.83rem; line-height:1.35; color:var(--clr-text-dim); flex-grow:1; }
    .post-meta {
      display:flex; align-items:center; justify-content:space-between;
      font-size:.65rem; letter-spacing:.7px; text-transform:uppercase; color:var(--clr-text-dim); margin-top:.2rem;
    }
    .btn-inline {
      font-size:.7rem; font-weight:600; letter-spacing:.5px;
      display:inline-flex; align-items:center; gap:.4rem;
      padding:.45rem .8rem; border-radius:.55rem;
      background:rgba(79,177,245,.13); color:#cfeafe;
      border:1px solid rgba(79,177,245,.3); transition:var(--transition);
    }
    .btn-inline:hover {
      background:var(--clr-accent-alt); color:#082032;
      border-color:var(--clr-accent-alt); box-shadow:0 4px 14px -4px rgba(79,177,245,.6);
    }
    .btn-inline:focus-visible { outline:none; box-shadow:var(--focus-ring); }

    .skeleton {
      position:relative; overflow:hidden;
      background: linear-gradient(90deg, #1e3044 0%, #263d55 45%, #1e3044 90%);
      background-size:200% 100%; animation: shimmer 2.4s linear infinite;
      border-radius:.4rem;
    }
    @keyframes shimmer {
      0% { background-position:200% 0; }
      100% { background-position:-200% 0; }
    }
    .skeleton-thumb { height:180px; border-bottom:1px solid rgba(255,255,255,.05); }
    .skeleton-line { height:12px; margin:12px 16px; width: calc(90% - 32px); }
    .skeleton-line.short { width:50%; }

    footer.footer {
      background:#0d1b2a; border-top:1px solid var(--clr-border);
      padding:3rem 1.5rem 4rem; color:var(--clr-text-dim);
    }
    footer a { color:var(--clr-accent-alt); }
    footer a:hover { color:#fff; }

    a:focus-visible, button:focus-visible { outline:none; box-shadow:var(--focus-ring); }

    .image-mode-wrapper {
      display:flex; gap:.5rem; align-items:center;
      font-size:.65rem; text-transform:uppercase; letter-spacing:.5px;
      color:var(--clr-text-dim);
    }
    .image-mode-wrapper select {
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.15);
      color:var(--clr-text);
      border-radius:10px;
      padding:.4rem .6rem;
      font-size:.7rem;
    }
    .image-mode-wrapper select:focus {
      border-color:var(--clr-accent-alt); box-shadow:var(--focus-ring); outline:none;
    }

    @media (max-width: 840px) {
      #featured-cards { justify-content:center; }
      .hero.is-landing { min-height:480px; }
      .post-card { flex:1 1 calc(50% - 1.5rem); }
    }
    @media (max-width: 560px) {
      .post-card { flex:1 1 100%; max-width:520px; }
      .hero .title { font-size:2.35rem; }
      .hero .subtitle { font-size:1.05rem; }
    }
  </style>
</head>
<body>
  <nav class="navbar is-dark is-fixed-top" role="navigation" aria-label="main navigation">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="/">Modern Airline Retailing</a>
        <button class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
          <span aria-hidden="true"></span><span aria-hidden="true"></span><span aria-hidden="true"></span>
        </button>
      </div>
      <div id="navMenu" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item is-active" href="/index.html">Home</a>
          <a class="navbar-item" href="/blog/index.html">Blog</a>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link" href="/tools/">Tools</a>
            <div class="navbar-dropdown">
              <a class="navbar-item" href="/tools/great-circle.html">Great Circle Distance</a>
              <a class="navbar-item" href="/tools/airport-lookup.html">Airport / City Lookup</a>
            </div>
          </div>
          <a class="navbar-item" href="/about.html">About Me</a>
        </div>
      </div>
    </div>
  </nav>

  <section class="hero is-landing">
    <div class="hero-body">
      <div class="container has-text-centered">
        <h1 class="title is-1">Modern Airline Retailing</h1>
        <p class="subtitle is-4">Tools, insights and real-world stories from the airline tech stack.</p>
        <!-- Changed from <button> to <a href="#featured"> for graceful fallback -->
        <a href="#featured" class="hero-cta" id="scrollLatest">
          Read Latest Blogs <span style="font-size:1.1em;">↘</span>
        </a>
      </div>
    </div>
  </section>

  <section id="featured" class="section" aria-labelledby="latest-heading">
    <div class="container">
      <div class="level">
        <div class="level-left">
          <h2 id="latest-heading" class="title is-3">Latest from the Blog</h2>
        </div>
        <div class="level-right" style="display:flex;align-items:center;gap:1rem;">
          <div class="image-mode-wrapper">
            <label for="featImgMode" style="margin:0;">Images</label>
            <select id="featImgMode" aria-label="Featured image mode">
              <option value="sticky">Sticky</option>
              <option value="always">Re-roll</option>
              <option value="off">Off</option>
            </select>
          </div>
          <a class="button is-link is-light" href="/blog/">View All Blogs</a>
        </div>
      </div>

      <!-- Static fallback (will be replaced by JS) -->
      <div id="featured-cards">
        <article class="post-card reveal" aria-hidden="true">
          <div class="skeleton skeleton-thumb"></div>
          <div class="post-body">
            <div class="skeleton skeleton-line"></div>
            <div class="skeleton skeleton-line"></div>
            <div class="skeleton skeleton-line short"></div>
          </div>
        </article>
        <article class="post-card reveal" aria-hidden="true">
          <div class="skeleton skeleton-thumb"></div>
          <div class="post-body">
            <div class="skeleton skeleton-line"></div>
            <div class="skeleton skeleton-line"></div>
            <div class="skeleton skeleton-line short"></div>
          </div>
        </article>
        <article class="post-card reveal" aria-hidden="true">
          <div class="skeleton skeleton-thumb"></div>
          <div class="post-body">
            <div class="skeleton skeleton-line"></div>
            <div class="skeleton skeleton-line"></div>
            <div class="skeleton skeleton-line short"></div>
          </div>
        </article>
      </div>
      <div id="feed-status" style="margin-top:2rem;font-size:.85rem;color:var(--clr-text-dim);display:none;"></div>
    </div>
  </section>

  <footer class="footer">
    <div class="content has-text-centered">
      <p>© <span id="year"></span> Modern Airline Retailing</p>
      <p><img src="https://visitor-badge.laobi.icu/badge?page_id=icodeforpassion.modernairlineretailing" alt="Visitor counter badge"></p>
    </div>
  </footer>

  <script>
    // ---- IMAGE MODE CONFIG ----
    let FEATURE_IMAGE_MODE = 'sticky';
    const FEATURE_IMAGE_POOL = [
      { url:'https://images.unsplash.com/photo-1529070538774-1843cb3265df?auto=format&fit=crop&w=900&q=60', alt:'Aircraft banking in clear sky' },
      { url:'https://images.unsplash.com/photo-1465447142348-e9952c393450?auto=format&fit=crop&w=900&q=60', alt:'Storm clouds viewed from window' },
      { url:'https://images.unsplash.com/photo-1517142089942-ba376ce32a0b?auto=format&fit=crop&w=900&q=60', alt:'Analytics dashboard screen' },
      { url:'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=900&q=60', alt:'Abstract roadmap lines' },
      { url:'https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=900&q=60', alt:'Code on monitor' },
      { url:'https://images.unsplash.com/photo-1508615070457-7baeba4003a0?auto=format&fit=crop&w=900&q=60', alt:'Seat map abstract grid' },
      { url:'https://images.unsplash.com/photo-1487058792275-0ad4aaf24ca7?auto=format&fit=crop&w=900&q=60', alt:'Database icons concept' },
      { url:'https://images.unsplash.com/photo-1450101215322-bf5cd27642fc?auto=format&fit=crop&w=900&q=60', alt:'Vintage split-flap board' },
      { url:'https://images.unsplash.com/photo-1600269452121-4f2416e55c28?auto=format&fit=crop&w=900&q=60', alt:'Security padlock digital' }
    ];
    const featureImageCache = {};
    function hashStr(str){
      let h = 2166136261 >>> 0;
      for(let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = (h * 16777619) >>> 0;
      }
      return h;
    }
    function pickFeaturedImage(key){
      if (FEATURE_IMAGE_MODE === 'off') {
        return {
          url:'data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="480" height="300"><rect width="480" height="300" fill="#1f3145"/><text x="40" y="160" font-size="26" fill="#9fb3c5" font-family="Arial,sans-serif">No Image</text></svg>'),
          alt:'Placeholder graphic'
        };
      }
      if (FEATURE_IMAGE_MODE === 'always') {
        return FEATURE_IMAGE_POOL[Math.floor(Math.random()*FEATURE_IMAGE_POOL.length)];
      }
      if (!featureImageCache[key]) {
        const idx = hashStr(key) % FEATURE_IMAGE_POOL.length;
        featureImageCache[key] = FEATURE_IMAGE_POOL[idx];
      }
      return featureImageCache[key];
    }
    function imageBadgeHTML(){
      if (FEATURE_IMAGE_MODE === 'off') return '';
      if (FEATURE_IMAGE_MODE === 'always') return '<span class="img-badge" title="Random each load">RND</span>';
      return '<span class="img-badge" title="Deterministic random">IMG</span>';
    }

    // ---- POSTS DATA (sync with /blog/index.html) ----
    const BLOG_POSTS = [
      { date:'2025-06-25', title:'The 2025 Roadmap: Capabilities to Prioritize Now', slug:'2025-06-25-the-2025-roadmap:-capabilities-to-prioritize-now' },
      { date:'2025-06-03', title:'Retail KPIs: Measuring What Matters', slug:'2025-06-03-retail-kpis:-measuring-what-matters' },
      { date:'2025-05-12', title:'Migration Paths: Coexisting with Legacy Inventory', slug:'2025-05-12-migration-paths:-coexisting-with-legacy-inventory' },
      { date:'2025-04-20', title:'Security and Trust: Signing Offers and Protecting APIs', slug:'2025-04-20-security-and-trust:-signing-offers-and-protecting-apis' },
      { date:'2025-03-29', title:'Irregular Ops: Disruption Handling with Orders', slug:'2025-03-29-irregular-ops:-disruption-handling-with-orders' },
      { date:'2025-03-07', title:'Reshop and Changes: Designing for Flexibility', slug:'2025-03-07-reshop-and-changes:-designing-for-flexibility' },
      { date:'2025-02-13', title:'Search Architecture: Ranking, Pruning and Repricing', slug:'2025-02-13-search-architecture:-ranking,-pruning-and-repricing' },
      { date:'2025-01-22', title:'Telemetry and Data Quality: Measuring the Offer Funnel', slug:'2025-01-22-telemetry-and-data-quality:-measuring-the-offer-funnel' },
      { date:'2024-12-31', title:'Payments and Clearing: From BSP/ARC to Modern Rails', slug:'2024-12-31-payments-and-clearing:-from-bsp-arc-to-modern-rails' },
      { date:'2024-12-09', title:'Interline in an Order World: Offers, Orders, Settlement', slug:'2024-12-09-interline-in-an-order-world:-offers,-orders,-settlement' },
      { date:'2024-11-17', title:'Merchandising: Attributes, Bundles and Post‑Purchase', slug:'2024-11-17-merchandising:-attributes,-bundles-and-post-purchase' },
      { date:'2024-10-26', title:'Identity and Personalization in Offers', slug:'2024-10-26-identity-and-personalization-in-offers' },
      { date:'2024-10-04', title:'Designing Airline APIs: Idempotency and Versioning', slug:'2024-10-04-designing-airline-apis:-idempotency-and-versioning' },
      { date:'2024-09-12', title:'Event-Driven Retailing: From Batch to Streaming', slug:'2024-09-12-event-driven-retailing:-from-batch-to-streaming' },
      { date:'2024-08-21', title:'Stock Keeper: Managing Seats and Products as Stock', slug:'2024-08-21-stock-keeper:-managing-seats-and-products-as-stock' },
      { date:'2024-07-30', title:'Order Management: Life After PNR, Tickets and EMDs', slug:'2024-07-30-order-management:-life-after-pnr,-tickets-and-emds' },
      { date:'2024-07-08', title:'Direct Connect vs Aggregators: Latency and Control', slug:'2024-07-08-direct-connect-vs-aggregators:-latency-and-control' },
      { date:'2024-06-16', title:'NDC in the Real World: Seller and Airline Responsibilities', slug:'2024-06-16-ndc-in-the-real-world:-seller-and-airline-responsibilities' },
      { date:'2024-05-25', title:'Offer Construction: Pricers, Bundlers and Context', slug:'2024-05-25-offer-construction:-pricers,-bundlers-and-context' },
      { date:'2024-05-03', title:'Continuous Pricing: Beyond Filed Ladders', slug:'2024-05-03-continuous-pricing:-beyond-filed-ladders' },
      { date:'2024-04-11', title:'Why Caches Disagree: GDS vs Airline Host Availability', slug:'2024-04-11-why-caches-disagree:-gds-vs-airline-host-availability' },
      { date:'2024-03-20', title:'Availability Controls: O&D, Nesting, and Married Segments', slug:'2024-03-20-availability-controls:-oandd,-nesting,-and-married-segments' },
      { date:'2024-02-27', title:'ATPCO Fare Filing: Fares, Rules and Footnotes in Practice', slug:'2024-02-27-atpco-fare-filing:-fares,-rules-and-footnotes-in-practice' },
      { date:'2024-02-05', title:'From TTY to EDIFACT: Structuring Airline Messages', slug:'2024-02-05-from-tty-to-edifact:-structuring-airline-messages' },
      { date:'2024-01-15', title:'Early RBD Revenue Management: How Booking Classes Shaped Control', slug:'2024-01-15-early-rbd-revenue-management:-how-booking-classes-shaped-control' }
    ].map(p=>({...p,url:'/blog/'+p.slug+'.html'}));

    // ---- UTILITIES ----
    const START_DATE = new Date('2024-01-01T00:00:00Z');
    const TODAY = new Date();
    function clampToRange(d){ if(d<START_DATE) return START_DATE; if(d>TODAY) return TODAY; return d; }
    function formatISO(d){ return d.toISOString().slice(0,10); }
    function formatHuman(d){ return d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}); }
    function escapeHTML(str){ return str.replace(/[&<>'"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function deriveExcerptFromTitle(t){ return (t.length<60)?('A closer look at '+t.toLowerCase()+' in modern airline retailing.'): t.slice(0,92).replace(/\s+\S*$/,'')+'…'; }

    // ---- FEATURED ----
    function getLatest(n=3){
      return BLOG_POSTS.map(p=>{
        const d = clampToRange(new Date(p.date+'T00:00:00Z'));
        return {...p,dateObj:d,iso:formatISO(d),displayDate:formatHuman(d)};
      }).sort((a,b)=>b.dateObj-a.dateObj).slice(0,n);
    }

    function renderFeatured(){
      try {
        const cont = document.getElementById('featured-cards');
        if(!cont) return;
        const posts = getLatest(3);
        cont.innerHTML = '';
        posts.forEach(p=>{
          const img = pickFeaturedImage(p.slug);
          cont.insertAdjacentHTML('beforeend', `
            <article class="post-card" data-date="${p.iso}">
              <a href="${p.url}" aria-label="${escapeHTML(p.title)}">
                <div class="post-media">
                  <img src="${img.url}" alt="${escapeHTML(img.alt || ('Illustration for '+p.title))}" loading="lazy" onerror="this.onerror=null;this.style.opacity=.35;">
                  <span class="badge-date">${p.displayDate}</span>
                  ${imageBadgeHTML()}
                </div>
                <div class="post-body">
                  <h3 class="post-title">${escapeHTML(p.title)}</h3>
                  <p class="post-excerpt">${escapeHTML(deriveExcerptFromTitle(p.title))}</p>
                  <div class="post-meta">
                    <span>${p.iso}</span>
                    <span><span class="btn-inline">Read →</span></span>
                  </div>
                </div>
              </a>
            </article>
          `);
        });
        observeCards();
      } catch(e){
        console.error('Render error', e);
        const status = document.getElementById('feed-status');
        if(status){
          status.style.display='block';
          status.textContent = 'Could not render latest posts.';
        }
      }
    }

    // ---- ANIMATION ----
    function observeCards(){
      if(!('IntersectionObserver' in window)){
        document.querySelectorAll('.post-card').forEach(c=>c.classList.add('reveal'));
        return;
      }
      const obs = new IntersectionObserver(entries=>{
        entries.forEach(en=>{
          if(en.isIntersecting){
            en.target.classList.add('reveal');
            obs.unobserve(en.target);
          }
        });
      },{threshold:.25});
      document.querySelectorAll('.post-card').forEach(c=>obs.observe(c));
    }

    // ---- SCROLL (with offset fallback) ----
    function scrollToFeatured(){
      const target = document.getElementById('featured');
      if(!target) return;
      if('scrollIntoView' in target){
        target.scrollIntoView({behavior:'smooth', block:'start'});
        return;
      }
      const y = target.getBoundingClientRect().top + window.scrollY - 80;
      window.scrollTo({top:y, behavior:'smooth'});
    }

    // ---- INIT ----
    document.addEventListener('DOMContentLoaded', ()=>{
      try{
        const burger = document.querySelector('.navbar-burger');
        const menu = document.getElementById('navMenu');
        burger.addEventListener('click', ()=>{
          burger.classList.toggle('is-active');
          menu.classList.toggle('is-active');
          burger.setAttribute('aria-expanded', burger.classList.contains('is-active'));
        });

        document.getElementById('year').textContent = new Date().getFullYear();

        // Enhance scroll trigger (prevent default anchor jump if we want smooth)
        const scrollBtn = document.getElementById('scrollLatest');
        scrollBtn.addEventListener('click', (e)=>{
          e.preventDefault();
          scrollToFeatured();
        });

        const modeSel = document.getElementById('featImgMode');
        modeSel.value = FEATURE_IMAGE_MODE;
        modeSel.addEventListener('change', ()=>{
          FEATURE_IMAGE_MODE = modeSel.value;
          if (FEATURE_IMAGE_MODE !== 'sticky'){
            for(const k in featureImageCache) delete featureImageCache[k];
          }
          renderFeatured();
        });

        // Directly render (remove artificial delay)
        renderFeatured();
      }catch(err){
        console.error('Init error', err);
      }
    });
  </script>
</body>
</html>
